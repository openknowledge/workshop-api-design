<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>Onlineshop</title>
  </head>
  <body>
    <h1>Onlineshop</h1>
    <button id="loginButton">Login</button>
    <div id="result"></div>
    <script>
        const authorizeEndpoint = "/realms/master/protocol/openid-connect/auth";
        const tokenEndpoint = "/realms/master/protocol/openid-connect/token";

        document.getElementById("loginButton").onclick = function() {
            var redirectUri = window.location.href;
            var args = new URLSearchParams({
                client_id: "onlineshop",
                scope: "openid",
                response_type: "code",
                redirect_uri: redirectUri
            });
            console.log("args", args);
            window.location = authorizeEndpoint + "/?" + args;
        }

        if (window.location.search) {
            var args = new URLSearchParams(window.location.search);
            var code = args.get("code");

            if (code) {
                fetch(tokenEndpoint, {
                    method: "POST",
                    headers: {
                        'Content-Type': 'application/x-www-form-urlencoded',
                    },
                    body: new URLSearchParams({
                        client_id: "onlineshop",
                        scope: "openid",
                        grant_type: "authorization_code",
                        redirect_uri: location.href.replace(location.search, ''),
                        code: code
                    })
                }
                ).then(response => response.json()
                ).then(json => {
                    document.getElementById("result").innerHTML = json.access_token;
                });
            }
        }
    </script>
  </body>
</html>
